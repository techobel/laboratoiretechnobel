{#Cette page inclut previewAnnonce.html à laquelle elle ajoute les infos sur le user#}

{% extends "::base.html.twig" %}

{% block stylesheets %}
    {{ parent() }}
    <link href="{{ asset('css/profile.css') }}" rel="stylesheet" type="text/css" />
    <!-- PROFILE STYLE SHEET -->
{% endblock %}

{% block title %}{{ annonce.getTitle }} {{ parent() }}{% endblock %}

{#{% block img_h3 %}src="{{ asset('images/pictos/user.png') }}" alt="Nous contacter" width="100" height="100"{% endblock %}#}
{% block img_h3 %}
    src="{{ asset(annonce.getSubCategorie.categorie.media.uploadDir ~ '/' ~ annonce.getSubCategorie.categorie.media.id ~ annonce.getSubCategorie.categorie.media.path) }}"
    alt="{{ annonce.getSubCategorie.categorie.media.alt }} - {{ annonce.getSubCategorie.name }}" width="100" height="100"{% endblock %}
{% block h3 %}{{ annonce.getSubCategorie.name }}{% endblock %}

{% block body %}
    {{ parent() }}
    
    <section id="general">
        <div class='container'>
            <div class='row'>
                {# Insérer l'aperçu de l'annonce ici #}
                {% include "TecServiceBundle::previewAnnonce.html.twig" %}
            </div>
        </div>
    </section>
    
    <section id="about">
        <div class='container'>
            <div class='row'>
                <h4>&Agrave; propos de {{ annonce.getUser.username }}</h4>
                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed non eros at enim mattis ornare. 
                    Cras porttitor bibendum ligula a interdum. 
                    Donec feugiat risus eget enim volutpat, a pellentesque massa mollis. 
                    Praesent posuere fermentum ex sed interdum. 
                    Fusce dignissim ante neque, et scelerisque diam laoreet ac.
                </p>
            </div>
        </div>
    </section>
    
    <!-- LINKS SECTION identique à celle des compétences sur le profil -->
    <section id="skill">
        <div class='container'>
            <div class='row'>
                <ul id="category">
                    <li class="col-md-1 col-xs-4">
                            <a href="{{ path('tec_service_getallannonce') }}">
                                <img src="{{ asset('images/pictos/search.png') }}" width="45" alt="" class="img-responsive" />
                                Retourner à la recherche
                            </a>
                    </li>
                    <li class="col-md-1 col-xs-4">
                            <a href="{{ path('tec_user_profil',{'id': annonce.getUser.id}) }}">
                                <img src="{{ asset('images/pictos/user.png') }}" width="45" alt="" class="img-responsive" />
                                Consulter le profil de {{ annonce.getUser.username }}
                            </a>
                    </li>
                    <li class="col-md-1 col-xs-4">
                            <a href="{{ path('tec_user_contact') }}">
                                <img src="{{ asset('images/pictos/contact.png') }}" width="45" alt="" class="img-responsive" />
                                Contacter le membre
                            </a>
                    </li>
                    <li class="col-md-1 col-xs-4">
                            <a href="{{ path('tec_service_getannoncecategorie',{'id': 1}) }}">
                                <img src="{{ asset('images/pictos/coop.png') }}" width="45" alt="" class="img-responsive" />
                                Rendre service
                            </a>
                    </li>
                </ul>
            </div>
        </div>
    </section>
    <!-- LINKS SECTION END-->
    
    
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js" type="text/javascript"></script> 
    <script>
    var villeuser = $('#villeuser').text();
    
    if(villeuser !== ''){
    
        $('.ville').each(function(index){
            console.log("Index: " + index + " Text: " + $(this).text());
            var villeannonce = $(this).text();
            calculdistance(villeuser, villeannonce, $(this));
        });
     }
    function calculdistance(villeuser, villeannonce, element){
        $.ajax({   
            data: {villeuser: villeuser, villeannonce: villeannonce},
            dataType: "json",
            type: "POST",
            url: "{{ path('tec_service_testcalcul') }}",
            success: function(data){
                    //console.log(data.distance);    
                    
                    element.append(" Distance: " + data.distance.substring(6, data.distance.length-2) + " Duree: " +data.duree.substring(6, data.duree.length-2));                       
                    },
            error: function(){
                console.log("erreur");
            }
        });
    }         
    </script> 
    <!-- SCRIPTS END-->

{% endblock %}

    
